{"version":3,"sources":["../server/server.js"],"names":["SourceMapSupport","install","dbConnection","db","app","use","express","static","bodyParser","json","get","req","res","collection","find","toArray","then","issues","metadata","total_count","length","_metadata","records","catch","error","console","log","status","message","post","newIssue","body","created","Date","err","Issue","validateIssue","insertOne","result","_id","insertedId","limit","next","newissue","MongoClient","connect","connection","listen"],"mappings":";;AAAA;;AACA;;;;AACA;;;;AACA;;AACA;;;;AACA;;;;;;AAEAA,2BAAiBC,OAAjB;;AAEA,IAAIC,YAAJ,EAAkBC,EAAlB;;AAEA,MAAMC,MAAM,wBAAZ;AACAA,IAAIC,GAAJ,CAAQC,kBAAQC,MAAR,CAAe,QAAf,CAAR;AACAH,IAAIC,GAAJ,CAAQG,qBAAWC,IAAX,EAAR;;AAEAL,IAAIM,GAAJ,CAAQ,aAAR,EAAuB,CAACC,GAAD,EAAMC,GAAN,KAAc;AACjCT,OAAGU,UAAH,CAAc,QAAd,EAAwBC,IAAxB,GAA+BC,OAA/B,GAAyCC,IAAzC,CAA8CC,UAAU;AACpD,cAAMC,WAAW,EAACC,aAAaF,OAAOG,MAArB,EAAjB;AACAR,YAAIH,IAAJ,CAAS,EAACY,WAAWH,QAAZ,EAAsBI,SAASL,MAA/B,EAAT;AACH,KAHD,EAGGM,KAHH,CAGSC,SAAS;AACdC,gBAAQC,GAAR,CAAYF,KAAZ;AACAZ,YAAIe,MAAJ,CAAW,GAAX,EAAgBlB,IAAhB,CAAqB,EAACmB,SAAU,0BAAyBJ,KAAM,EAA1C,EAArB;AACH,KAND;AAOH,CARD;;AAWApB,IAAIyB,IAAJ,CAAS,aAAT,EAAwB,CAAClB,GAAD,EAAMC,GAAN,KAAc;AAClC,UAAMkB,WAAWnB,IAAIoB,IAArB;AACAD,aAASE,OAAT,GAAmB,IAAIC,IAAJ,EAAnB;;AAEA,QAAG,CAACH,SAASH,MAAb,EAAqB;AACjBG,iBAASH,MAAT,GAAkB,KAAlB;AACH;AACD,UAAMO,MAAMC,gBAAMC,aAAN,CAAoBN,QAApB,CAAZ;AACA,QAAGI,GAAH,EAAQ;AACJtB,YAAIe,MAAJ,CAAW,GAAX,EAAgBlB,IAAhB,CAAqB,EAACmB,SAAU,oBAAmBM,GAAI,EAAlC,EAArB;AACA;AACH;;AAED/B,OAAGU,UAAH,CAAc,QAAd,EAAwBwB,SAAxB,CAAkCP,QAAlC,EAA4Cd,IAA5C,CAAiDsB,UAAU;AACvDnC,WAAGU,UAAH,CAAc,QAAd,EAAwBC,IAAxB,CAA6B,EAACyB,KAAKD,OAAOE,UAAb,EAA7B,EAAuDC,KAAvD,CAA6D,CAA7D,EAAgEC,IAAhE;AACH,KAFD,EAEG1B,IAFH,CAEQ2B,YAAY;AAChB/B,YAAIH,IAAJ,CAASqB,QAAT;AACH,KAJD,EAIGP,KAJH,CAISC,SAAS;AACdC,gBAAQC,GAAR,CAAY,OAAZ;AACAd,YAAIe,MAAJ,CAAW,GAAX,EAAgBlB,IAAhB,CAAqB,EAACmB,SAAU,yBAAwBJ,KAAM,EAAzC,EAArB;AACH,KAPD;AAQH,CArBD;;AAuBAoB,qBAAYC,OAAZ,CAAoB,qBAApB,EAA2C7B,IAA3C,CAAgD8B,cAAc;AAC1D5C,mBAAe4C,UAAf;AACA3C,SAAKD,aAAaC,EAAb,CAAgB,cAAhB,CAAL;;AAEAC,QAAI2C,MAAJ,CAAW,IAAX,EAAiB,YAAU;AACvBtB,gBAAQC,GAAR,CAAY,0BAAZ;AACH,KAFD;AAIH,CARD,EAQGH,KARH,CAQSC,SAAS;AACdC,YAAQC,GAAR,CAAY,QAAZ,EAAsBF,KAAtB;AACH,CAVD","file":"server.js","sourcesContent":["import 'babel-polyfill';\r\nimport express from 'express';\r\nimport bodyParser from 'body-parser';\r\nimport {MongoClient} from 'mongodb';\r\nimport Issue from './issue.js';\r\nimport SourceMapSupport from 'source-map-support';\r\n\r\nSourceMapSupport.install();\r\n\r\nlet dbConnection, db;\r\n\r\nconst app = express();\r\napp.use(express.static('static'));\r\napp.use(bodyParser.json());\r\n\r\napp.get('/api/issues', (req, res) => {\r\n    db.collection('issues').find().toArray().then(issues => {\r\n        const metadata = {total_count: issues.length};\r\n        res.json({_metadata: metadata, records: issues});\r\n    }).catch(error => {\r\n        console.log(error);\r\n        res.status(500).json({message: `Internal Server Error: ${error}`});\r\n    });\r\n});\r\n\r\n\r\napp.post('/api/issues', (req, res) => {\r\n    const newIssue = req.body;\r\n    newIssue.created = new Date();\r\n\r\n    if(!newIssue.status) {\r\n        newIssue.status = 'New';\r\n    }\r\n    const err = Issue.validateIssue(newIssue);\r\n    if(err) {\r\n        res.status(422).json({message: `Invalid request: ${err}`});\r\n        return;\r\n    }\r\n\r\n    db.collection('issues').insertOne(newIssue).then(result => {\r\n        db.collection('issues').find({_id: result.insertedId}).limit(1).next();\r\n    }).then(newissue => {\r\n        res.json(newIssue);\r\n    }).catch(error => {\r\n        console.log('error');\r\n        res.status(500).json({message: `Internal Server Error ${error}`});\r\n    });\r\n});\r\n\r\nMongoClient.connect('mongodb://localhost').then(connection => {\r\n    dbConnection = connection;\r\n    db = dbConnection.db('issuetracker');\r\n    \r\n    app.listen(3000, function(){\r\n        console.log('App started on port 3000');\r\n    });\r\n\r\n}).catch(error => {\r\n    console.log('ERROR:', error);\r\n});"]}